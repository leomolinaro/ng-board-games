<!-- <button (click)="printSlots ()">CLICK</button> -->
<svg:svg
  bgSvg
  xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="100%" height="100%"
  [attr.viewBox]="viewBox" preserveAspectratio="xMinYMin">
  <!-- <defs>
    <pattern id="mountain" height="100%" width="100%" patternContentUnits="objectBoundingBox">
      <image width="1" height="1" preserveAspectRatio="none" xlink:href="assets/barony/land-tiles/mountain.png"></image>
    </pattern>
    <pattern id="lake" height="100%" width="100%" patternContentUnits="objectBoundingBox">
      <image width="1" height="1" preserveAspectRatio="none" xlink:href="assets/barony/land-tiles/lake.png"></image>
    </pattern>
    <pattern id="plain" height="100%" width="100%" patternContentUnits="objectBoundingBox">
      <image width="1" height="1" preserveAspectRatio="none" xlink:href="assets/barony/land-tiles/plain.png"></image>
    </pattern>
    <pattern id="fields" height="100%" width="100%" patternContentUnits="objectBoundingBox">
      <image width="1" height="1" preserveAspectRatio="none" xlink:href="assets/barony/land-tiles/fields.png"></image>
    </pattern>
    <pattern id="forest" height="100%" width="100%" patternContentUnits="objectBoundingBox">
      <image width="1" height="1" preserveAspectRatio="none" xlink:href="assets/barony/land-tiles/forest.png"></image>
    </pattern>
  </defs> -->
  <svg:g
    #britMap
    [bgMapZoom]="{
      translateX: 0,
      translateY: 50,
      scale: 1
    }">
    <image [attr.width]="mapWidth" preserveAspectRatio="xMinYMin" xlink:href="assets/britannia/britannia-map.png"></image>
    <svg:g *ngFor="let areaNode of areaNodes; trackBy: areaTrackBy">
      <svg:path
        [attr.id]="'brit-area-' + areaNode.id" class="brit-area-path" [attr.d]="areaNode.path"
        [matTooltip]="areaNode | bgTransform:getAreaTooltip"
        (click)="onAreaClick (areaNode, $event)"></svg:path>
      
      <svg:circle *ngFor="let point of testGridPoints"
        [attr.cx]="point.x"
        [attr.cy]="point.y"
        [attr.r]="3"
        [attr.style]="'fill: ' + point.color"></svg:circle>
      
    </svg:g>

    <ng-container *ngIf="slotsReady">
      <ng-container *ngFor="let unitNode of unitNodes; trackBy: unitTrackBy">
        <svg:g *ngLet="{
          x: unitNode | bgTransform:getUnitNodeX,
          y: unitNode | bgTransform:getUnitNodeY
        } as c">
          <svg:rect
            class="brit-unit-rect"
            [attr.x]="c.x"
            [attr.y]="c.y"
            width="30"
            height="30">
          </svg:rect>
          <svg:image
            [matTooltip]="unitNode | bgTransform:getUnitTooltip"
            [attr.x]="c.x"
            [attr.y]="c.y"
            width="30"
            [attr.xlink:href]="unitNode.imageSource"/>
        </svg:g>
      </ng-container>
    </ng-container>

    <svg:g
      *ngFor="let populationNode of populationNodes; trackBy: populationTrackBy">
      <svg:path
        [attr.id]="'brit-population-track-' + populationNode.id" class="brit-population-track-path" [attr.d]="populationNode.path"
        [matTooltip]="populationNode | bgTransform:getPopulationTrackTooltip"></svg:path>
      <ng-container *ngFor="let nationNode of populationNode.nationNodes; trackBy: nationPopulationTrackBy; let i = index">
        <svg:g *ngLet="{
          x: nationNode | bgTransform:getNationPopulationNodeX:i:populationNode,
          y: nationNode | bgTransform:getNationPopulationNodeY:i:populationNode
        } as c">
          <svg:circle
            class="brit-population-circle"
            [attr.cx]="c.x + 10"
            [attr.cy]="c.y + 10"
            r="10">
          </svg:circle>
          <svg:image
            [matTooltip]="nationNode | bgTransform:getNationPopulationTooltip"
            [attr.x]="c.x"
            [attr.y]="c.y"
            width="20"
            [attr.xlink:href]="nationNode.imageSource"/>
        </svg:g>
      </ng-container>
    </svg:g>

    <svg:g
      *ngFor="let nationTurnNode of nationTurnNodes; trackBy: nationTurnTrackBy">
      <svg:path
        [attr.id]="'brit-nation-turn-' + nationTurnNode.id" class="brit-nation-turn-path" [attr.d]="nationTurnNode.path"
        [matTooltip]="nationTurnNode | bgTransform:getNationTurnTooltip"></svg:path>
    </svg:g>
    
    <svg:g
      *ngFor="let roundNode of roundNodes; trackBy: roundTrackBy">
      <svg:path
        [attr.id]="'brit-round-' + roundNode.id" class="brit-round-path" [attr.d]="roundNode.path"
        [matTooltip]="roundNode | bgTransform:getRoundTooltip"></svg:path>
      <svg:g
        *ngFor="let eventNode of roundNode.eventNodes; trackBy: eventTrackBy">
        <svg:path
          [attr.id]="'brit-event-' + roundNode.id + '-' + eventNode.id" class="brit-event-path" [attr.d]="eventNode.path"
          [matTooltip]="eventNode | bgTransform:getEventTooltip"></svg:path>
      </svg:g>
      <svg:path *ngIf="roundNode.scoringPath"
        [attr.id]="'brit-scoring-' + roundNode.id" class="brit-scoring-path" [attr.d]="roundNode.scoringPath"
        matTooltip="Scoring Round"></svg:path>
    </svg:g>


      <!-- baronyLandTile
      [type]="land.type"
      [coordinates]="land.coordinates"
      [pawns]="land.pawns"
      [active]="isValid ? isValid[land.id] : false"
      [disabled]="isValid ? !isValid[land.id] : false"
      (landTileClick)="onLandTileClick (land)"> -->
  </svg:g>
</svg:svg>
